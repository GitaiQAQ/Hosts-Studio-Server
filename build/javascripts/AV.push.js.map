{"version":3,"sources":["javascripts/AV.push.js"],"names":["e","t","n","AV","define","amd","o","heartbeatsTime","i","r","a","open","close","message","reuse","error","s","options","undefined","ws","heartbeatsTimer","ec","closeFlag","reuseTimer","log","loginPush","heartbeats","guard","emit","c","JSON","parse","data","cmd","ackPush","ids","msg","length","u","p","send","stringify","f","push","channels","getId","appId","storage","id","sendId","ajax","url","host","method","appKey","deviceType","installationId","setTimeout","sendPush","code","__op","objects","createSocket","WebSocket","addEventListener","clearTimeout","on","connect","server","now","expires","getServer","secure","location","protocol","region","ttl","cache","this","once","off","where","expiration_time","expiration_interval","push_time","subscribe","unsubscribe","receive","loadFlashPolicyFile","peerId","clientId","eventCenter","version","_tool","_engine","noop","Date","toString","Math","random","substring","console","XMLHttpRequest","setRequestHeader","onprogress","ontimeout","timeout","onload","status","responseText","onerror","localStorage","getItem","test","setItem","split","call","window"],"mappings":"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","file":"javascripts/AV.push.js","sourcesContent":["void function(e){var t=\"2.0.4\";var n=e.AV||{};e.AV=n;if(typeof define===\"function\"&&define.amd){define(\"AV\",[],function(){return n})}var o={heartbeatsTime:30*1e3};var i={};var r={};var a={open:\"open\",close:\"close\",message:\"message\",reuse:\"reuse\",error:\"error\"};var s=function(){var t={options:undefined,ws:undefined,heartbeatsTimer:undefined,ec:undefined,closeFlag:false,reuseTimer:undefined};var n=function(){i.log(\"WebSocket opened.\");r.loginPush(t.options);r.heartbeats();r.guard();t.ec.emit(a.open)};var s=function(){i.log(\"WebSocket closed.\");t.ec.emit(a.close)};var c=function(e){var n=JSON.parse(e.data);if(n.cmd===\"data\"){r.ackPush(n.ids);var o;var i=n.msg.length;for(o=0;o<i;o++){t.ec.emit(a.message,n.msg[o])}}};var u=function(e){throw e};var p=function(e){t.ws.send(JSON.stringify(e))};var f=function(e,t,n){var o=[];if(typeof e===\"string\"){o.push(e)}else{o=e}r.channels(o,t,n)};r.getId=function(e){var t=\"AV/\"+e.appId+\"/installationId\";var n=i.storage(t);if(n){return n}else{id=i.getId();e.id=id;r.sendId(e,function(e){i.storage(t,id)});return id}};r.sendId=function(e,n){i.ajax({url:\"https://\"+t.options.host+\"/1.1/installations\",method:\"post\",appId:e.appId,appKey:e.appKey,data:{deviceType:e.deviceType,installationId:e.id,channels:e.channels}},function(o){if(o){if(n){n(o);t.ec.emit(\"leancloud-send-id-ok\")}}else{setTimeout(function(){r.sendId(e)},5e3)}})};r.sendPush=function(e,n){i.ajax({url:\"https://\"+t.options.host+\"/1.1/push\",method:\"post\",appId:e.appId,appKey:e.appKey,data:{data:e.data,channels:e.channels}},function(t,o){if(t){if(n){n(t)}}else{if(o.code===403||o.code===404){throw o.error}else{setTimeout(function(){r.sendPush(e,n)},5e3)}}})};r.channels=function(e,n,o){var r={installationId:t.options.id,deviceType:t.options.deviceType};if(o){r.channels={__op:\"Remove\",objects:e}}else{r.channels=e}i.ajax({url:\"https://\"+t.options.host+\"/1.1/installations\",method:\"post\",appId:t.options.appId,appKey:t.options.appKey,data:r},function(e){if(n){n(e)}})};r.createSocket=function(e){var o=new WebSocket(e);t.ws=o;o.addEventListener(\"open\",n);o.addEventListener(\"close\",s);o.addEventListener(\"message\",c);o.addEventListener(\"error\",u)};r.heartbeats=function(){p({});t.ws.addEventListener(\"message\",function(){if(t.heartbeatsTimer){clearTimeout(t.heartbeatsTimer)}t.heartbeatsTimer=setTimeout(function(){p({})},o.heartbeatsTime)})};r.guard=function(){t.ec.on(a.close,function(){if(!t.closeFlag){t.ec.emit(a.reuse)}})};r.connect=function(e){var n=e.server;if(n&&i.now()<n.expires){r.createSocket(n.server)}else{t.ec.emit(a.error);throw\"WebSocket connet failed.\"}};r.ackPush=function(e){p({cmd:\"ack\",appId:t.options.appId,installationId:t.options.id,ids:e})};r.loginPush=function(e){p({cmd:\"login\",appId:e.appId,installationId:e.id})};r.getServer=function(n,o){var r=n.appId;var s=n.secure;var c=\"\";var u=\"http://\";if(e&&e.location.protocol===\"https:\"){u=\"https://\"}var p=\"\";switch(n.region){case\"cn\":p=\"g0\";break;case\"us\":p=\"a0\";break;default:throw\"There is no this region.\"}c=u+\"router-\"+p+\"-push.leancloud.cn/v1/route?appId=\"+r;if(s){c+=\"&secure=1\"}i.ajax({url:c},function(e,n){if(e){e.expires=i.now()+e.ttl*1e3;t.server=e;o(e)}else{if(n.code===403||n.code===404){throw n.error}else{t.ec.emit(a.error)}}})};return{installationId:\"\",cache:t,open:function(e){var n=this;r.getServer(t.options,function(e){if(e){r.connect({server:t.server})}});if(e){t.ec.on(a.open,e)}t.ec.once(a.reuse+\" \"+a.error,function(){if(t.reuseTimer){clearTimeout(t.reuseTimer)}t.reuseTimer=setTimeout(function(){n.open()},5e3)});return this},close:function(){t.closeFlag=true;t.ws.close();return this},on:function(e,n){t.ec.on(e,n);return this},once:function(e,n){t.ec.once(e,n);return this},off:function(e,n){t.ec.off(e,n);return this},emit:function(e,n){t.ec.emit(e,n);return this},send:function(e,n){var o={appId:t.options.appId,appKey:t.options.appKey};if(!e.channels&&!e.where&&!e.expiration_time&&!e.expiration_interval&&!e.push_time){o.data=e;r.sendPush(o,n)}else{for(var i in e){o[i]=e[i]}r.sendPush(o,n)}return this},subscribe:function(e,t){f(e,t);return this},unsubscribe:function(e,t){f(e,t,true);return this},receive:function(e){if(!e){throw\"Receive must hava callback.\"}t.ec.on(a.message,function(t){e(t)});return this}}};n.push=function(t){if(typeof t!==\"object\"){throw\"AV.push need a argument at least.\"}else if(!t.appId){throw\"Options must have appId.\"}else if(!t.appKey){throw\"Options must have appKey.\"}else{var n=e.WebSocket.loadFlashPolicyFile?false:true;t={appId:t.appId,appKey:t.appKey,peerId:t.clientId,secure:typeof t.secure===\"undefined\"?n:t.secure,region:t.region||\"cn\",channels:t.channels||[],deviceType:\"web\"};switch(t.region){case\"cn\":t.host=\"leancloud.cn\";break;case\"us\":t.host=\"avoscloud.us\";break}var o=s();o.cache.options=t;t.id=r.getId(t);o.installationId=t.id;o.cache.ec=i.eventCenter();return o}};n.push.version=t;n.push._tool=i;n.push._engine=r;i.noop=function(){};i.getId=function(){var e=function(){return Date.now().toString(36)+Math.random().toString(36).substring(2,3)};return\"AV-\"+e()+\"-\"+e()+\"-\"+e()};i.log=function(e){console.log(e)};i.ajax=function(e,t){var n=e.url;var o=e.method||\"get\";var i=new XMLHttpRequest;i.open(o,n);if(o===\"post\"||o===\"put\"){i.setRequestHeader(\"Content-Type\",\"application/json\")}if(e.appId){i.setRequestHeader(\"X-AVOSCloud-Application-Id\",e.appId)}if(e.appKey){i.setRequestHeader(\"X-AVOSCloud-Application-Key\",e.appKey)}i.onprogress=function(){};i.ontimeout=function(){};i.timeout=0;i.onload=function(e){if(i.status>=200&&i.status<300){t(JSON.parse(i.responseText))}else{t(null,JSON.parse(i.responseText))}};i.onerror=function(e){t(null,e);throw\"Network error.\"};i.send(JSON.stringify(e.data))};i.now=function(){return Date.now()};i.storage=function(t,n){if(n){if(typeof n===\"object\"){n=JSON.stringify(n)}e.localStorage.setItem(t,n)}else{var o=e.localStorage.getItem(t);if(/^[\\{|\\[]/.test(o)&&/[\\}|\\]]$/.test(o)){o=JSON.parse(o)}return o}};i.eventCenter=function(){var e={};var t={};var n=function(n,o,i){if(!n){throw\"No event name.\"}else if(!o){throw\"No callback function.\"}var r=n.split(/\\s+/);var a;if(!i){a=e}else{a=t}for(var s=0,c=r.length;s<c;s++){if(r[s]){if(!a[r[s]]){a[r[s]]=[]}a[r[s]].push(o)}}};var o=function(n,o,i){var r;if(!i){r=e}else{r=t}if(r[n]){var a=0;var s=r[n].length;for(;a<s;a++){if(r[n][a]===o){r[n][a]=null;return}}}};function i(e){var t=[];var n=0;var o=e.length;if(o){for(;n<o;n++){if(e[n]){t.push(e[n])}}return t}else{return null}}return{on:function(e,t){n(e,t);return this},once:function(e,t){n(e,t,true);return this},emit:function(n,r){if(!n){throw\"No emit event name.\"}var a=0;var s=0;if(e[n]){a=0;s=e[n].length;for(;a<s;a++){if(e[n][a]){e[n][a].call(this,r)}}e[n]=i(e[n])}if(t[n]){a=0;s=t[n].length;for(;a<s;a++){if(t[n][a]){t[n][a].call(this,r);o(n,t[n][a],true)}}t[n]=i(t[n])}return this},off:function(e,t){o(e,t);return this}}}}(window);"],"sourceRoot":"/source/"}