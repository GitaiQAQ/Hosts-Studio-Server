void function(e){var t="0.0.1",n=e.AV||{};e.AV=n,"function"==typeof define&&define.amd&&define("AV",[],function(){return n});var a={},o={},i=function(e){var t=e.appId,n=e.appKey,i=e.version||null,r=e.channel||null;return{send:function(e,s){var u=[];if(e&&e.length)u=e;else{if(!e||!e.event)throw"EventObject must have a event value.";var p={event:e.event,attr:e.attr,duration:e.duration,tag:e.tag};u.push(p)}for(var d=0,l=u.length;l>d;d++)u[d].attributes=u[d].attr,delete u[d].attr;var c="https://api.leancloud.cn/1.1/stats/open/collect",f={client:{id:o.getId(),platform:"web",app_version:i,app_channel:r},session:{id:a.getId()},events:u};a.ajax({url:c,method:"post",data:f,appId:t,appKey:n},function(e,t){s&&s(e?e:t)})}}};n.analytics=function(e){if("object"!=typeof e)throw"AV.analytics need a argument at least.";if(!e.appId)throw"Options must have appId.";if(!e.appKey)throw"Options must have appKey.";var t=i(e);return o.pageView(t),o.sessionView(t),t},n.analytics.version=t,n.analytics._tool=a,n.analytics._engine=o,o.getId=function(){var t="leancloud-analytics-id",n=e.localStorage.getItem(t);return n||(n=a.getId(),e.localStorage.setItem(t,n)),n},o.pageView=function(t){function n(){i=a.now(),s=e.location.href}function o(){r=a.now(),t.send({event:"_page",duration:r-i,tag:s})}var i,r,s;n(),e.addEventListener("hashchange",function(e){o(),n()}),e.addEventListener("beforeunload",function(){o()})},o.sessionView=function(t){var n=a.now();e.addEventListener("beforeunload",function(){var e=a.now();t.send({event:"_session.close",duration:e-n})})},a.getId=function(){var e=function(){return(new Date).getTime().toString(36)+Math.random().toString(36).substring(2,3)};return"AV"+e()+e()+e()},a.ajax=function(e,t){var n=e.url,a=e.method||"get",o=new XMLHttpRequest;o.open(a,n),("post"===a||"put"===a)&&o.setRequestHeader("Content-Type","application/json"),e.appId&&o.setRequestHeader("X-AVOSCloud-Application-Id",e.appId),e.appKey&&o.setRequestHeader("X-AVOSCloud-Application-Key",e.appKey),o.onload=function(e){o.status>=200&&o.status<300?t(JSON.parse(o.responseText)):t(null,JSON.parse(o.responseText))},o.onerror=function(e){throw t(null,e),"Network error."},o.send(JSON.stringify(e.data))},a.now=function(){return(new Date).getTime()}}(window);
//# sourceMappingURL=analytics.js.map
